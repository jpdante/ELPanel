using MySql.Data.MySqlClient;using System;using System.Collections.Generic;using System.Reflection;using System.Text;

namespace ELPanel.Manager {
    public class MySqlManager : IDisposable {        private string ConnectString;        public MySqlManager(string connString) {            ConnectString = connString;        }        public MySqlConnection GetMySqlConnection() {            MySqlConnection conn = new MySqlConnection(ConnectString);            conn.Open();            return conn;        }        public bool CheckLogin(string email, string password, MySqlConnection conn) {            using var cmd = new MySqlCommand("SELECT `id` FROM `accounts` WHERE `email` = @email AND `password` = @password;", conn);            cmd.Parameters.AddWithValue("email", email);            cmd.Parameters.AddWithValue("password", password);            using MySqlDataReader reader = cmd.ExecuteReader();            return reader.HasRows;        }        public void CloseMySqlConnection(MySqlConnection connection) {            connection.Close();            connection.Dispose();        }

        public ServerInfo[] GetServers(MySqlConnection conn) {            var serverInfos = new List<ServerInfo>();            using (var cmd = new MySqlCommand("SELECT * FROM `servers`;", conn)) {				using var reader = cmd.ExecuteReader();                if (!reader.HasRows) return serverInfos.ToArray();                while (reader.Read()) {                    serverInfos.Add(new ServerInfo(                        reader.GetInt32(0),                        reader.GetString(1),                        reader.GetString(2),                        reader.GetString(3),                        reader.GetString(4),                        reader.GetInt32(5),                        reader.GetInt32(6)                    ));                }            }            return serverInfos.ToArray();        }        public void Dispose() {            GC.SuppressFinalize(this);        }    }}